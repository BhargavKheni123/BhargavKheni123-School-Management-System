@model List<Digital.Models.ViewModels.StudentAssignmentItemViewModel>
@{
    ViewBag.Title = "Assignments";
    var student = ViewBag.Student;
}

<h2 class="mb-4">Your Assignments</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<table class="table table-bordered table-striped">
    <thead class="thead-dark">
        <tr>
            <th>Subject</th>
            <th>Title</th>
            <th>Assigned</th>
            <th>Deadline</th>
            <th>Marks</th>
            <th>Assignment Doc</th>
            <th>Your Submission</th>
            <th>Upload</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            var a = item.Assignment;
            var s = item.Submission;
            bool closed = DateTime.Now > a.SubmissionDeadline;


            <tr>
                <td>@(a.Subject?.Name ?? "-")</td>
                <td>@a.Title</td>
                <td>@a.CreatedDate.ToString("yyyy-MM-dd")</td>
                <td>@a.SubmissionDeadline.ToString("yyyy-MM-dd HH:mm")</td>

                <td>@(s?.Marks?.ToString() ?? "-")</td>

                <td>
                    @if (!string.IsNullOrEmpty(a.FilePath))
                    {
                        <a href="@Url.Action("DownloadAssignment", "Teacher", new { id = a.Id })" target="_blank">
                            Download
                        </a>
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>

                <td>
                    @if (s != null && !string.IsNullOrEmpty(s.FilePath))
                    {
                        <a href="@Url.Action("DownloadSubmission", "StudentAssignment", new { id = s.Id })" target="_blank">
                            View Submission
                        </a>
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>

                <td>
                    @if (closed)
                    {
                        <span class="text-danger">Closed</span>
                    }
                    else
                    {
                        <form asp-action="Upload" asp-controller="StudentAssignment" method="post" enctype="multipart/form-data">
                            <input type="hidden" name="AssignmentId" value="@a.Id" />
                            <input type="file" name="file" class="form-control-file d-inline-block" required />
                            <button type="submit" class="btn btn-primary btn-sm mt-1">Upload</button>
                        </form>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
