@model digital.ViewModels.TeacherSubmissionViewModel

<h2>Submissions for @Model.AssignmentTitle</h2>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Student ID</th>
            <th>File</th>
            <th>Submitted On</th>
            <th>Grade</th>
            <th>Checked</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var sub in Model.Submissions)
        {
            <tr>
                <td>@sub.StudentId</td>
                <td>
                    <a href="@sub.FilePath" target="_blank">View</a>
                </td>
                <td>@sub.SubmissionDate?.ToShortDateString() ?? "Not Submitted"</td>
                <td>@(string.IsNullOrEmpty(sub.Grade) ? "Not Graded" : sub.Grade)</td>
                <td>@(sub.IsChecked ? "right" : "wrong")</td>
                <td>
                    <button class="btn btn-sm btn-primary"
                            onclick="openEvaluationModal(@sub.SubmissionId, '@sub.Grade', @sub.IsChecked.ToString().ToLower())">
                        Evaluate
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Evaluation Modal -->
<div id="evaluationModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Evaluate Submission</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="submissionId" />
                <div class="form-group">
                    <label>Grade</label>
                    <input type="text" id="gradeInput" class="form-control" />
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="checkedInput" /> Checked</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="saveEvaluation()">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function openEvaluationModal(submissionId, grade, isChecked) {
            $("#submissionId").val(submissionId);
            $("#gradeInput").val(grade);
            $("#checkedInput").prop("checked", isChecked);
            $("#evaluationModal").modal("show");
        }

        function saveEvaluation() {
            var submissionId = $("#submissionId").val();
            var grade = $("#gradeInput").val();
            var isChecked = $("#checkedInput").prop("checked");

            $.post('/Teacher/SaveEvaluation',
                { submissionId: submissionId, grade: grade, isChecked: isChecked },
                function (res) {
                    if (res.success) {
                        location.reload();
                    } else {
                        alert(res.message);
                    }
                });
        }
    </script>
}
